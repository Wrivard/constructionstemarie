<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google Maps API</title>
</head>
<body>
    <h1>Google Maps API Test</h1>
    <div id="status">Testing API endpoint...</div>
    <div id="map" style="width: 100%; height: 400px; margin-top: 20px;"></div>

    <script>
        async function testMapsAPI() {
            const statusDiv = document.getElementById('status');
            
            try {
                // Test our API endpoint
                const response = await fetch('/api/maps-config');
                const data = await response.json();
                
                if (data.apiKey) {
                    statusDiv.innerHTML = '✅ API Key loaded successfully: ' + data.apiKey.substring(0, 20) + '...';
                    
                    // Load Google Maps
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${data.apiKey}&libraries=places`;
                    script.onload = () => {
                        initMap();
                    };
                    script.onerror = () => {
                        statusDiv.innerHTML = '❌ Failed to load Google Maps API';
                    };
                    document.head.appendChild(script);
                } else {
                    statusDiv.innerHTML = '❌ No API key returned from endpoint';
                }
            } catch (error) {
                statusDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }

        function initMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: { lat: 45.8506, lng: -73.8370 }
            });

            const marker = new google.maps.Marker({
                position: { lat: 45.8506, lng: -73.8370 },
                map: map,
                title: 'Construction Ste-Marie'
            });

            document.getElementById('status').innerHTML += '<br>✅ Google Maps loaded successfully!';
        }

        // Run test when page loads
        testMapsAPI();
    </script>
</body>
</html>
